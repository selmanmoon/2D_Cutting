

'2d cutting project

Type part2D
    name As String
    length As Integer
    width As Integer
End Type


Type MainPart
    x As Integer
    y As Integer
End Type

Type problem2D
    parts() As part2D
    resource() As MainPart
End Type
Dim indexdegeri As Integer
Sub dosyaOpen_Click()
    Dim myFile As String
    'myFile = "C:\Users\TUBA AY\Desktop\case1.txt"
    myFile = Application.GetOpenFilename()
    Open myFile For Input As #1
    row_number = 6
    a = 0
    Worksheets("Data").Range("C6:K37").Clear
Do Until EOF(1)
    Line Input #1, LineFromFile

    LineItems = Split(LineFromFile, ",")

        Sheets("Data").Cells(row_number, 3).Value = LineItems(0)
        Sheets("Data").Cells(row_number, 4).Value = LineItems(1)
        Sheets("Data").Cells(row_number, 5).Value = LineItems(2)
   
    
    row_number = row_number + 1
    
Loop
Close #1
Summarize Sheets("Data").Range("E6:E60"), Sheets("Data").Range("G6")
Summarize Sheets("Data").Range("D6:D60"), Sheets("Data").Range("H6")


End Sub
Sub Summarize(rngSource As Range, rngTarget As Range)
    Dim d As New Scripting.Dictionary
    Dim rng As Range
    Dim var As Variant

    For Each rng In rngSource
        If rng <> "" Then
            If d.Exists(rng.Value) Then
                d(rng.Value) = d(rng.Value) + 1
            Else
                d.Add rng.Value, 1
            End If
        End If
    Next rng

    rngTarget = "Value"
    rngTarget.Offset(, 1) = "Count"
    Set rng = rngTarget.Offset(1)
    For Each var In d.Keys
        rng = var
        rng.Offset(, 1) = d(var)
        Set rng = rng.Offset(1)
    Next
End Sub

Sub takeParts(p As problem2D, kaydir As Integer)
    
    b = 1
    a = Cells(6, 6)
    'toplam parça sayısını hesaplıyoruz..
    Dim partCount As Integer
    partCount = Range("range").End(xlDown).Row - 5
    For i = 1 To partCount
        Sum = Sum + Cells(i + 5, 6)
    Next
    'hareketli döngü elde ederek tablodaki parçaları array içine aldık..
    ReDim p.parts(Sum + 1)
    For i = 1 To partCount
        For j = b To a
            p.parts(j).name = Cells(i + 5, 3)
            p.parts(j).width = Cells(i + 5, 4)
            p.parts(j).length = Cells(i + 5, 5)
        Next
     b = a + 1
     a = a + Cells(i + 6, 6)
    Next
    Dim cuttedCount() As Integer
    ReDim cuttedCount(Sum)
    'yine döngü içerisinde ana kaynağımızın değerlerini array içine alıyoruz..
    resourceCount = Range("range2").End(xlDown).Row - 5
    ReDim p.resource(resourceCount)
    For i = 1 To resourceCount
    
        p.resource(i).x = Cells(i + 5, 9)
        p.resource(i).y = Cells(i + 5, 10)
    Next
    'parçaları y uzunluklarına göre büyükten küçüğe sıraladık..
    If Cells(14, 10).Value = "No" Then
         First = LBound(p.parts) + 1
         Last = UBound(p.parts)
         For i = First To Last - 1
             For j = i + 1 To Last
                 If p.parts(i).length < p.parts(j).length Then
                     temp = p.parts(j).length 'burda sadece 1tanesini sıralasak olmuyor denendi onaylandı
                     p.parts(j).length = p.parts(i).length
                     p.parts(i).length = temp
                     
                     temp2 = p.parts(j).width
                     p.parts(j).width = p.parts(i).width
                     p.parts(i).width = temp2
                     
                     temp3 = p.parts(j).name
                     p.parts(j).name = p.parts(i).name
                     p.parts(i).name = temp3
                 End If
             Next
        Next
    Else
        For i = 1 To Sum
            If p.parts(i).length < p.parts(i).width Then
                temp = p.parts(i).width
                p.parts(i).width = p.parts(i).length
                p.parts(i).length = temp
            End If
        Next
        
    End If
    
   'görsel kısmı, daha çok iş var burda
    'ufaktan başladık yerleştirmeye..
    Dim Shp As Shape
    'gözlük ve ok butonu dışında herşeyi siliyoruz ekrandan
    For Each Shp In ActiveSheet.Shapes
    If Not (Shp.name = "OkButton" Or Shp.name = "selmanmoon" Or Shp.name = "sol" Or Shp.name = "sag" Or Shp.name = "dosyaOpen" Or Shp.name = "info") Then Shp.Delete
    Next Shp
    Dim partArea As Long, totalArea As Long
    Dim sq As Shape
    Dim sq2 As Shape
    Set sq = Sheets("Interface").Shapes.AddShape(msoShapeRectangle, 620 + kaydir, 60, p.resource(1).x / Cells(22, 20), p.resource(1).y / Cells(22, 20))
    sq.name = "Selman"
    'ana parçanın rengini değiştirdik aro
    Sheets("Interface").Shapes("Selman").Fill.ForeColor.RGB = RGB(255, 227, 169)
       wtf = 1
       yArttir = 1
       p.parts(Sum + 1).length = 1000 'fazladan arraye 1 ekledik çünkü hata veriyodu böyle düzeldi gg wp
       For Count = 1 To Sum
           'buraya yazıcagım 2 satır aşırı gereksiz sadece sunumda hızlı çalışsın diye yazıyorum
                While p.parts(Count).length <= p.resource(1).y 'yerleştirmeye başlıyoruz inş
                        p.resource(1).y = p.resource(1).y - p.parts(Count).length
                        p.resource(1).x = Cells(6, 9)
               For i = Count To Sum 'aynılarını bi daha döndürüyo şuraya el at
                    If p.parts(i).width <= p.resource(1).x Then
                        p.resource(1).x = p.resource(1).x - p.parts(i).width
                        partArea = partArea + (p.parts(i).length * p.parts(i).width) 'waste hesaplamak için gerekli bir satır
    
                        'bu satır tamamen şekille alakalı şeqil şuqul adamıyız
                        Set sq2 = Sheets("Interface").Shapes.AddShape(msoShapeRectangle, 620 + kaydir + sum8, 60 + sum9, p.parts(i).width / Cells(22, 20), p.parts(i).length / Cells(22, 20))
                        sq2.TextFrame.Characters.Text = p.parts(i).name
                        sq2.TextFrame.Characters.Font.Size = 8
                        sq2.TextFrame.HorizontalAlignment = xlHAlignCenter
                        sq2.TextFrame.VerticalAlignment = xlVAlignCenter
                        yArttir = yArttir + 1 'şurası gereksiz olabilir bakıcam birdaha
                        sum8 = (p.parts(i).width / Cells(22, 20)) + sum8 'grafik için gerekli
                        Count = Count + 1
                        'deneme yapıyorum inş olr
                        'p.parts(i).length = 0
                        'p.parts(i).name = ""
                        'p.parts(i).width = 0
                        For fz = 1 To partCount
                            If p.parts(i).name = Cells(fz + 5, 3) Then
                                cuttedCount(fz) = cuttedCount(fz) + 1
                            End If
                        Next
                        For fz = 1 To partCount
                            Cells(fz + 13, 6) = cuttedCount(fz)
                        Next
                        
                    End If
                Next
                sum8 = 0
                
                sum9 = (p.parts(wtf).length / Cells(22, 20)) + sum9 'grafik için gerekli
                wtf = Count  'vee bu iş burda biteer
           Wend
        Next
        totalArea = (Cells(6, 9) * Cells(6, 10))
        Cells(17, 9) = totalArea - partArea & " cm2"
        
    
    

    'kalan alanı çekmeye çalışıyoruz..
    
        

    'max ı bul, y den çıkar, bir satır kes, sonra kestiklerini başka arraye at
    ' sonra kalan parçaların max y'sini bul, bir satır kes yine devam (x den yer kalana kadar))
    'sonra kalanlardan maxı bul, y den büyükse durdur, 2. parçaya bak o da y den büyükse, 3.ye bak
    '3.parça y den küçükse onu ve sonrasını kes , kalanların hepsi waste kardeş.. bunu yaz şimdilik sonra rotate e gireriz.
    
    
       
   

   
 
    
    
      
        
 
End Sub


Sub MainForm()
Dim kaydirmaVol As Integer
Cells(22, 14) = 0
kaydirmaVol = 0
Dim p As problem2D
Call takeParts(p, kaydirmaVol)


End Sub


Sub sol_Click()
Dim p As problem2D
Dim kaydirmaVol As Integer

' sol_Click Macro
'
Cells(22, 14) = Cells(22, 14) - 3
kaydirmaVol = Cells(22, 14)
Call takeParts(p, kaydirmaVol)
End Sub
Sub sag_Click()
'
' sag_Click Macro
'
Dim p As problem2D
Dim kaydirmaVol As Integer

' sol_Click Macro
'
Cells(22, 14) = Cells(22, 14) + 3
kaydirmaVol = Cells(22, 14)
Call takeParts(p, kaydirmaVol)
'

End Sub


